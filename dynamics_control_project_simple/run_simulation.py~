"""Run Simulation."""
from .control.pid import PID
from .dynamics.system import MassSpringDamper
from .simulation.plotting import plot_everything
from .simulation.simulator import Simulator
import numpy as np


def main():
    """simulate."""
    system = MassSpringDamper(m=1.0, k=20.0, c=2.0)
    controller = PID(kp=1, ki=5, kd=800)
    sim = Simulator(system, controller)

    def reference_func(t):
        """Define a time-dependent reference (e.g., a sine wave)."""
        return np.sin(5 * 2 * np.pi * t) + np.sin(5 * 2 * np.pi * t)
        # Example: sin(2Ï€ * t)

    history = sim.run(x0=[0, 0],
                      dt=0.001,
                      tf=2.0,
                      reference=reference_func,
                      integration_method='rk4_step')
    print('Final state:', history['state'][-1])

    plot_everything(history, system)


if __name__ == '__main__':
    main()
